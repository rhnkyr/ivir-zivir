GMaps.prototype.toImage=function(b){var b=b||{},d={};d.size=b.size||[this.el.clientWidth,this.el.clientHeight];d.lat=this.getCenter().lat();d.lng=this.getCenter().lng();if(this.markers.length>0){d.markers=[];for(var c=0;c<this.markers.length;c++){d.markers.push({lat:this.markers[c].getPosition().lat(),lng:this.markers[c].getPosition().lng()})}}if(this.polylines.length>0){var a=this.polylines[0];d.polyline={};d.polyline["path"]=google.maps.geometry.encoding.encodePath(a.getPath());d.polyline["strokeColor"]=a.strokeColor;d.polyline["strokeOpacity"]=a.strokeOpacity;d.polyline["strokeWeight"]=a.strokeWeight}return GMaps.staticMapURL(d)};GMaps.staticMapURL=function(b){var e=[],t,c="http://maps.googleapis.com/maps/api/staticmap";if(b.url){c=b.url;delete b.url}c+="?";var r=b.markers;delete b.markers;if(!r&&b.marker){r=[b.marker];delete b.marker}var m=b.polyline;delete b.polyline;if(b.center){e.push("center="+b.center);delete b.center}else{if(b.address){e.push("center="+b.address);delete b.address}else{if(b.lat){e.push(["center=",b.lat,",",b.lng].join(""));delete b.lat;delete b.lng}else{if(b.visible){var a=encodeURI(b.visible.join("|"));e.push("visible="+a)}}}}var k=b.size;if(k){if(k.join){k=k.join("x")}delete b.size}else{k="630x300"}e.push("size="+k);if(!b.zoom){b.zoom=15}var s=b.hasOwnProperty("sensor")?!!b.sensor:true;delete b.sensor;e.push("sensor="+s);for(var f in b){if(b.hasOwnProperty(f)){e.push(f+"="+b[f])}}if(r){var g,h;for(var p=0;t=r[p];p++){g=[];if(t.size&&t.size!=="normal"){g.push("size:"+t.size)}else{if(t.icon){g.push("icon:"+encodeURI(t.icon))}}if(t.color){g.push("color:"+t.color.replace("#","0x"))}if(t.label){g.push("label:"+t.label[0].toUpperCase())}h=(t.address?t.address:t.lat+","+t.lng);if(g.length||p===0){g.push(h);g=g.join("|");e.push("markers="+encodeURI(g))}else{g=e.pop()+encodeURI("|"+h);e.push(g)}}}function q(i,j){if(i[0]==="#"){i=i.replace("#","0x");if(j){j=parseFloat(j);j=Math.min(1,Math.max(j,0));if(j===0){return"0x00000000"}j=(j*255).toString(16);if(j.length===1){j+=j}i=i.slice(0,8)+j}}return i}if(m){t=m;m=[];if(t.strokeWeight){m.push("weight:"+parseInt(t.strokeWeight,10))}if(t.strokeColor){var n=q(t.strokeColor,t.strokeOpacity);m.push("color:"+n)}if(t.fillColor){var u=q(t.fillColor,t.fillOpacity);m.push("fillcolor:"+u)}var l=t.path;if(l.join){for(var o=0,d;d=l[o];o++){m.push(d.join(","))}}else{m.push("enc:"+l)}m=m.join("|");e.push("path="+encodeURI(m))}e=e.join("&");return c+e};