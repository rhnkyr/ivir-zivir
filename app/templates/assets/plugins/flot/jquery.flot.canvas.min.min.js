(function(k){var h={canvas:true};var n,m,i;var l=Object.prototype.hasOwnProperty;function j(a,b){var c=b.Canvas;if(n==null){m=c.prototype.getTextInfo,i=c.prototype.addText,n=c.prototype.render}c.prototype.render=function(){if(!a.getOptions().canvas){return n.call(this)}var A=this.context,C=this._textCache;A.save();A.textBaseline="middle";for(var G in C){if(l.call(C,G)){var B=C[G];for(var H in B){if(l.call(B,H)){var g=B[H],e=true;for(var F in g){if(l.call(g,F)){var z=g[F],J=z.positions,D=z.lines;if(e){A.fillStyle=z.font.color;A.font=z.font.definition;e=false}for(var d=0,I;I=J[d];d++){if(I.active){for(var f=0,E;E=I.lines[f];f++){A.fillText(D[f].text,E[0],E[1])}}else{J.splice(d--,1)}}if(J.length==0){delete g[F]}}}}}}}A.restore()};c.prototype.getTextInfo=function(I,E,f,e,A){if(!a.getOptions().canvas){return m.call(this,I,E,f,e,A)}var H,C,g,z;E=""+E;if(typeof f==="object"){H=f.style+" "+f.variant+" "+f.weight+" "+f.size+"px "+f.family}else{H=f}C=this._textCache[I];if(C==null){C=this._textCache[I]={}}g=C[H];if(g==null){g=C[H]={}}z=g[E];if(z==null){var B=this.context;if(typeof f!=="object"){var J=k("<div>&nbsp;</div>").css("position","absolute").addClass(typeof f==="string"?f:null).appendTo(this.getTextLayer(I));f={lineHeight:J.height(),style:J.css("font-style"),variant:J.css("font-variant"),weight:J.css("font-weight"),family:J.css("font-family"),color:J.css("color")};f.size=J.css("line-height",1).height();J.remove()}H=f.style+" "+f.variant+" "+f.weight+" "+f.size+"px "+f.family;z=g[E]={width:0,height:0,positions:[],lines:[],font:{definition:H,color:f.color}};B.save();B.font=H;var D=(E+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var d=0;d<D.length;++d){var F=D[d],G=B.measureText(F);z.width=Math.max(G.width,z.width);z.height+=f.lineHeight;z.lines.push({text:F,width:G.width,height:f.lineHeight})}B.restore()}return z};c.prototype.addText=function(J,G,I,F,B,y,D,d,H){if(!a.getOptions().canvas){return i.call(this,J,G,I,F,B,y,D,d,H)}var C=this.getTextInfo(J,F,B,y,D),f=C.positions,x=C.lines;I+=C.height/x.length/2;if(H=="middle"){I=Math.round(I-C.height/2)}else{if(H=="bottom"){I=Math.round(I-C.height)}else{I=Math.round(I)}}if(!!(window.opera&&window.opera.version().split(".")[0]<12)){I-=2}for(var g=0,e;e=f[g];g++){if(e.x==G&&e.y==I){e.active=true;return}}e={active:true,lines:[],x:G,y:I};f.push(e);for(var g=0,E;E=x[g];g++){if(d=="center"){e.lines.push([Math.round(G-E.width/2),I])}else{if(d=="right"){e.lines.push([Math.round(G-E.width),I])}else{e.lines.push([Math.round(G),I])}}I+=E.height}}}k.plot.plugins.push({init:j,options:h,name:"canvas",version:"1.0"})})(jQuery);