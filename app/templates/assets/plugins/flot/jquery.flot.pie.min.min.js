(function(j){var h=10;var g=0.95;function i(e){var P=null,G=null,K=null,D=null,J=null,R=false,B=null;var O=[];e.hooks.processOptions.push(function(k,l){if(l.series.pie.show){l.grid.show=false;if(l.series.pie.label.show=="auto"){if(l.legend.show){l.series.pie.label.show=false}else{l.series.pie.label.show=true}}if(l.series.pie.radius=="auto"){if(l.series.pie.label.show){l.series.pie.radius=3/4}else{l.series.pie.radius=1}}if(l.series.pie.tilt>1){l.series.pie.tilt=1}else{if(l.series.pie.tilt<0){l.series.pie.tilt=0}}}});e.hooks.bindEvents.push(function(k,m){var l=k.getOptions();if(l.series.pie.show){if(l.grid.hoverable){m.unbind("mousemove").mousemove(E)}if(l.grid.clickable){m.unbind("click").click(M)}}});e.hooks.processDatapoints.push(function(k,n,m,l){var o=k.getOptions();if(o.series.pie.show){d(k,n,m,l)}});e.hooks.drawOverlay.push(function(l,k){var m=l.getOptions();if(m.series.pie.show){c(l,k)}});e.hooks.draw.push(function(k,l){var m=k.getOptions();if(m.series.pie.show){I(k,l)}});function d(k,m,l){if(!R){R=true;P=k.getCanvas();G=j(P).parent();f=k.getOptions();k.setData(a(k.getData()))}}function a(m){var o=0,p=0,k=0,r=f.series.pie.combine.color,l=[];for(var q=0;q<m.length;++q){var n=m[q].data;if(j.isArray(n)&&n.length==1){n=n[0]}if(j.isArray(n)){if(!isNaN(parseFloat(n[1]))&&isFinite(n[1])){n[1]=+n[1]}else{n[1]=0}}else{if(!isNaN(parseFloat(n))&&isFinite(n)){n=[1,+n]}else{n=[1,0]}}m[q].data=[n]}for(var q=0;q<m.length;++q){o+=m[q].data[0][1]}for(var q=0;q<m.length;++q){var n=m[q].data[0][1];if(n/o<=f.series.pie.combine.threshold){p+=n;k++;if(!r){r=m[q].color}}}for(var q=0;q<m.length;++q){var n=m[q].data[0][1];if(k<2||n/o>f.series.pie.combine.threshold){l.push({data:[[1,n]],color:m[q].color,label:m[q].label,angle:n*Math.PI*2/o,percent:n/(o/100)})}}if(k>1){l.push({data:[[1,p]],color:r,label:f.series.pie.combine.label,angle:p*Math.PI*2/o,percent:p/(o/100)})}return l}function I(r,o){if(!G){return}var l=r.getPlaceholder().width(),t=r.getPlaceholder().height(),p=G.children().filter(".legend").children().width()||0;B=o;R=false;K=Math.min(l,t/f.series.pie.tilt)/2;J=t/2+f.series.pie.offset.top;D=l/2;if(f.series.pie.offset.left=="auto"){if(f.legend.position.match("w")){D+=p/2}else{D-=p/2}}else{D+=f.series.pie.offset.left}if(D<K){D=K}else{if(D>l-K){D=l-K}}var q=r.getData(),n=0;do{if(n>0){K*=g}n+=1;s();if(f.series.pie.tilt<=0.8){k()}}while(!m()&&n<h);if(n>=h){s();G.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(r.setSeries&&r.insertLegend){r.setSeries(q);r.insertLegend()}function s(){B.clearRect(0,0,l,t);G.children().filter(".pieLabel, .pieLabelBackground").remove()}function k(){var v=f.series.pie.shadow.left;var w=f.series.pie.shadow.top;var y=10;var x=f.series.pie.shadow.alpha;var u=f.series.pie.radius>1?f.series.pie.radius:K*f.series.pie.radius;if(u>=l/2-v||u*f.series.pie.tilt>=t/2-w||u<=y){return}B.save();B.translate(v,w);B.globalAlpha=x;B.fillStyle="#000";B.translate(D,J);B.scale(1,f.series.pie.tilt);for(var z=1;z<=y;z++){B.beginPath();B.arc(0,0,u,0,Math.PI*2,false);B.fill();u-=z}B.restore()}function m(){var x=Math.PI*f.series.pie.startAngle;var u=f.series.pie.radius>1?f.series.pie.radius:K*f.series.pie.radius;B.save();B.translate(D,J);B.scale(1,f.series.pie.tilt);B.save();var v=x;for(var y=0;y<q.length;++y){q[y].startAngle=v;w(q[y].angle,q[y].color,true)}B.restore();if(f.series.pie.stroke.width>0){B.save();B.lineWidth=f.series.pie.stroke.width;v=x;for(var y=0;y<q.length;++y){w(q[y].angle,f.series.pie.stroke.color,false)}B.restore()}b(B);B.restore();if(f.series.pie.label.show){return z()}else{return true}function w(A,V,U){if(A<=0||isNaN(A)){return}if(U){B.fillStyle=V}else{B.strokeStyle=V;B.lineJoin="round"}B.beginPath();if(Math.abs(A-Math.PI*2)>1e-9){B.moveTo(0,0)}B.arc(0,0,u,v,v+A/2,false);B.arc(0,0,u,v+A/2,v+A,false);B.closePath();v+=A;if(U){B.fill()}else{B.stroke()}}function z(){var A=x;var X=f.series.pie.label.radius>1?f.series.pie.label.radius:K*f.series.pie.label.radius;for(var V=0;V<q.length;++V){if(q[V].percent>=f.series.pie.label.threshold*100){if(!W(q[V],A,V)){return false}}A+=q[V].angle}return true;function W(ao,S,U){if(ao.data[0][1]==0){return true}var am=f.legend.labelFormatter,an,ak=f.series.pie.label.formatter;if(am){an=am(ao.label,ao)}else{an=ao.label}if(ak){an=ak(an,ao)}var av=((S+ao.angle)+S)/2;var ap=D+Math.round(Math.cos(av)*X);var ar=J+Math.round(Math.sin(av)*X)*f.series.pie.tilt;var aa="<span class='pieLabel' id='pieLabel"+U+"' style='position:absolute;top:"+ar+"px;left:"+ap+"px;'>"+an+"</span>";G.append(aa);var aq=G.children("#pieLabel"+U);var al=(ar-aq.height()/2);var T=(ap-aq.width()/2);aq.css("top",al);aq.css("left",T);if(0-al>0||0-T>0||t-(al+aq.height())<0||l-(T+aq.width())<0){return false}if(f.series.pie.label.background.opacity!=0){var au=f.series.pie.label.background.color;if(au==null){au=ao.color}var at="top:"+al+"px;left:"+T+"px;";j("<div class='pieLabelBackground' style='position:absolute;width:"+aq.width()+"px;height:"+aq.height()+"px;"+at+"background-color:"+au+";'></div>").css("opacity",f.series.pie.label.background.opacity).insertBefore(aq)}return true}}}}function b(l){if(f.series.pie.innerRadius>0){l.save();var k=f.series.pie.innerRadius>1?f.series.pie.innerRadius:K*f.series.pie.innerRadius;l.globalCompositeOperation="destination-out";l.beginPath();l.fillStyle=f.series.pie.stroke.color;l.arc(0,0,k,0,Math.PI*2,false);l.fill();l.closePath();l.restore();l.save();l.beginPath();l.strokeStyle=f.series.pie.stroke.color;l.arc(0,0,k,0,Math.PI*2,false);l.stroke();l.closePath();l.restore()}}function H(m,l){for(var k=false,n=-1,p=m.length,o=p-1;++n<p;o=n){((m[n][1]<=l[1]&&l[1]<m[o][1])||(m[o][1]<=l[1]&&l[1]<m[n][1]))&&(l[0]<(m[o][0]-m[n][0])*(l[1]-m[n][1])/(m[o][1]-m[n][1])+m[n][0])&&(k=!k)}return k}function F(w,x){var X=e.getData(),z=e.getOptions(),y=z.series.pie.radius>1?z.series.pie.radius:K*z.series.pie.radius,t,v;for(var m=0;m<X.length;++m){var q=X[m];if(q.pie.show){B.save();B.beginPath();B.moveTo(0,0);B.arc(0,0,y,q.startAngle,q.startAngle+q.angle/2,false);B.arc(0,0,y,q.startAngle+q.angle/2,q.startAngle+q.angle,false);B.closePath();t=w-D;v=x-J;if(B.isPointInPath){if(B.isPointInPath(w-D,x-J)){B.restore();return{datapoint:[q.percent,q.data],dataIndex:0,series:q,seriesIndex:m}}}else{var n=y*Math.cos(q.startAngle),o=y*Math.sin(q.startAngle),W=y*Math.cos(q.startAngle+q.angle/4),Z=y*Math.sin(q.startAngle+q.angle/4),s=y*Math.cos(q.startAngle+q.angle/2),u=y*Math.sin(q.startAngle+q.angle/2),k=y*Math.cos(q.startAngle+q.angle/1.5),l=y*Math.sin(q.startAngle+q.angle/1.5),A=y*Math.cos(q.startAngle+q.angle),Y=y*Math.sin(q.startAngle+q.angle),p=[[0,0],[n,o],[W,Z],[s,u],[k,l],[A,Y]],r=[t,v];if(H(p,r)){B.restore();return{datapoint:[q.percent,q.data],dataIndex:0,series:q,seriesIndex:m}}}B.restore()}}return null}function E(k){L("plothover",k)}function M(k){L("plotclick",k)}function L(m,p){var l=e.offset();var r=parseInt(p.pageX-l.left);var k=parseInt(p.pageY-l.top);var n=F(r,k);if(f.grid.autoHighlight){for(var s=0;s<O.length;++s){var q=O[s];if(q.auto==m&&!(n&&q.series==n.series)){Q(q.series)}}}if(n){N(n.series,m)}var o={pageX:p.pageX,pageY:p.pageY};G.trigger(m,[o,n])}function N(l,k){var m=C(l);if(m==-1){O.push({series:l,auto:k});e.triggerRedrawOverlay()}else{if(!k){O[m].auto=false}}}function Q(k){if(k==null){O=[];e.triggerRedrawOverlay()}var l=C(k);if(l!=-1){O.splice(l,1);e.triggerRedrawOverlay()}}function C(k){for(var m=0;m<O.length;++m){var l=O[m];if(l.series==k){return m}}return -1}function c(l,k){var n=l.getOptions();var p=n.series.pie.radius>1?n.series.pie.radius:K*n.series.pie.radius;k.save();k.translate(D,J);k.scale(1,n.series.pie.tilt);for(var m=0;m<O.length;++m){o(O[m].series)}b(k);k.restore();function o(q){if(q.angle<=0||isNaN(q.angle)){return}k.fillStyle="rgba(255, 255, 255, "+n.series.pie.highlight.opacity+")";k.beginPath();if(Math.abs(q.angle-Math.PI*2)>1e-9){k.moveTo(0,0)}k.arc(0,0,p,q.startAngle,q.startAngle+q.angle/2,false);k.arc(0,0,p,q.startAngle+q.angle/2,q.startAngle+q.angle,false);k.closePath();k.fill()}}}var f={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(b,a){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+a.color+";'>"+b+"<br/>"+Math.round(a.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};j.plot.plugins.push({init:i,options:f,name:"pie",version:"1.1"})})(jQuery);