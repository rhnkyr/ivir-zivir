/*!
 * jQVMap Version 1.0
 *
 * http://jqvmap.com
 *
 * Copyright 2012, Peter Schmalfeldt <manifestinteractive@gmail.com>
 * Copyright 2011-2012, Kirill Lebedev
 * Licensed under the MIT license.
 *
 * Fork Me @ https://github.com/manifestinteractive/jqvmap
 */
(function(j){var i={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,enableZoom:1,showTooltip:1,borderColor:1,borderWidth:1,borderOpacity:1,selectedRegions:1,multiSelectRegion:1};var g={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick",onRegionSelect:"regionSelect",onRegionDeselect:"regionDeselect"};j.fn.vectorMap=function(d){var c={map:"world_en",backgroundColor:"#a5bfdd",color:"#f4f3f0",hoverColor:"#c9dfaf",selectedColor:"#c9dfaf",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear",enableZoom:true,showTooltip:true,borderColor:"#818181",borderWidth:1,borderOpacity:0.25,selectedRegions:null,multiSelectRegion:false},a=this.data("mapObject");if(d==="addMap"){l.maps[arguments[1]]=arguments[2]}else{if(d==="set"&&i[arguments[1]]){a["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(a,Array.prototype.slice.call(arguments,2))}else{if(typeof d==="string"&&typeof a[d]==="function"){return a[d].apply(a,Array.prototype.slice.call(arguments,1))}else{j.extend(c,d);c.container=this;this.css({position:"relative",overflow:"hidden"});a=new l(c);this.data("mapObject",a);for(var b in g){if(c[b]){this.bind(g[b]+".jqvmap",c[b])}}}}}};var k=function(c,d,a){this.mode=window.SVGAngle?"svg":"vml";this.params=a;if(this.mode=="svg"){this.createSvgNode=function(e){return document.createElementNS(this.svgns,e)}}else{try{if(!document.namespaces.rvml){document.namespaces.add("rvml","urn:schemas-microsoft-com:vml")}this.createVmlNode=function(e){return document.createElement("<rvml:"+e+' class="rvml">')}}catch(b){this.createVmlNode=function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}if(this.mode=="svg"){this.canvas=this.createSvgNode("svg")}else{this.canvas=this.createVmlNode("group");this.canvas.style.position="absolute"}this.setSize(c,d)};k.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(a,e){if(this.mode=="svg"){this.canvas.setAttribute("width",a);this.canvas.setAttribute("height",e)}else{this.canvas.style.width=a+"px";this.canvas.style.height=e+"px";this.canvas.coordsize=a+" "+e;this.canvas.coordorigin="0 0";if(this.rootGroup){var c=this.rootGroup.getElementsByTagName("shape");for(var b=0,d=c.length;b<d;b++){c[b].coordsize=a+" "+e;c[b].style.width=a+"px";c[b].style.height=e+"px"}this.rootGroup.coordsize=a+" "+e;this.rootGroup.style.width=a+"px";this.rootGroup.style.height=e+"px"}}this.width=a;this.height=e},createPath:function(d){var c;if(this.mode=="svg"){c=this.createSvgNode("path");c.setAttribute("d",d.path);if(this.params.borderColor!==null){c.setAttribute("stroke",this.params.borderColor)}if(this.params.borderWidth>0){c.setAttribute("stroke-width",this.params.borderWidth);c.setAttribute("stroke-linecap","round");c.setAttribute("stroke-linejoin","round")}if(this.params.borderOpacity>0){c.setAttribute("stroke-opacity",this.params.borderOpacity)}c.setFill=function(e){this.setAttribute("fill",e);if(this.getAttribute("original")===null){this.setAttribute("original",e)}};c.getFill=function(e){return this.getAttribute("fill")};c.getOriginalFill=function(){return this.getAttribute("original")};c.setOpacity=function(e){this.setAttribute("fill-opacity",e)}}else{c=this.createVmlNode("shape");c.coordorigin="0 0";c.coordsize=this.width+" "+this.height;c.style.width=this.width+"px";c.style.height=this.height+"px";c.fillcolor=l.defaultFillColor;c.stroked=false;c.path=k.pathSvgToVml(d.path);var a=this.createVmlNode("skew");a.on=true;a.matrix="0.01,0,0,0.01,0,0";a.offset="0,0";c.appendChild(a);var b=this.createVmlNode("fill");c.appendChild(b);c.setFill=function(e){this.getElementsByTagName("fill")[0].color=e;if(this.getAttribute("original")===null){this.setAttribute("original",e)}};c.getFill=function(e){return this.getElementsByTagName("fill")[0].color};c.getOriginalFill=function(){return this.getAttribute("original")};c.setOpacity=function(e){this.getElementsByTagName("fill")[0].opacity=parseInt(e*100,10)+"%"}}return c},createGroup:function(b){var a;if(this.mode=="svg"){a=this.createSvgNode("g")}else{a=this.createVmlNode("group");a.style.width=this.width+"px";a.style.height=this.height+"px";a.style.left="0px";a.style.top="0px";a.coordorigin="0 0";a.coordsize=this.width+" "+this.height}if(b){this.rootGroup=a}return a},applyTransformParams:function(a,b,c){if(this.mode=="svg"){this.rootGroup.setAttribute("transform","scale("+a+") translate("+b+", "+c+")")}else{this.rootGroup.coordorigin=(this.width-b)+","+(this.height-c);this.rootGroup.coordsize=this.width/a+","+this.height/a}}};k.pathSvgToVml=function(b){var e="";var f=0,a=0,c,d;return b.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(u,v,t,x){t=t.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");if(!t[0]){t.shift()}for(var w=0,s=t.length;w<s;w++){t[w]=Math.round(100*t[w])}switch(v){case"m":f+=t[0];a+=t[1];return"t"+t.join(",");break;case"M":f=t[0];a=t[1];return"m"+t.join(",");break;case"l":f+=t[0];a+=t[1];return"r"+t.join(",");break;case"L":f=t[0];a=t[1];return"l"+t.join(",");break;case"h":f+=t[0];return"r"+t[0]+",0";break;case"H":f=t[0];return"l"+f+","+a;break;case"v":a+=t[0];return"r0,"+t[0];break;case"V":a=t[0];return"l"+f+","+a;break;case"c":c=f+t[t.length-4];d=a+t[t.length-3];f+=t[t.length-2];a+=t[t.length-1];return"v"+t.join(",");break;case"C":c=t[t.length-4];d=t[t.length-3];f=t[t.length-2];a=t[t.length-1];return"c"+t.join(",");break;case"s":t.unshift(a-d);t.unshift(f-c);c=f+t[t.length-4];d=a+t[t.length-3];f+=t[t.length-2];a+=t[t.length-1];return"v"+t.join(",");break;case"S":t.unshift(a+a-d);t.unshift(f+f-c);c=t[t.length-4];d=t[t.length-3];f=t[t.length-2];a=t[t.length-1];return"c"+t.join(",");break;default:return false;break}return""}).replace(/z/g,"")};var l=function(a){a=a||{};var c=this;var b=l.maps[a.map];this.selectedRegions=[];this.multiSelectRegion=a.multiSelectRegion;this.container=a.container;this.defaultWidth=b.width;this.defaultHeight=b.height;this.color=a.color;this.selectedColor=a.selectedColor;this.hoverColor=a.hoverColor;this.hoverOpacity=a.hoverOpacity;this.setBackgroundColor(a.backgroundColor);this.width=a.container.width();this.height=a.container.height();this.resize();jQuery(window).resize(function(){c.width=a.container.width();c.height=a.container.height();c.resize();c.canvas.setSize(c.width,c.height);c.applyTransform()});this.canvas=new k(this.width,this.height,a);a.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(true);this.index=l.mapIndex;this.label=jQuery("<div/>").addClass("jqvmap-label").appendTo(jQuery("body"));if(a.enableZoom){jQuery("<div/>").addClass("jqvmap-zoomin").text("+").appendTo(a.container);jQuery("<div/>").addClass("jqvmap-zoomout").html("&#x2212;").appendTo(a.container)}c.countries=[];for(var e in b.pathes){var d=this.canvas.createPath({path:b.pathes[e].path});d.setFill(this.color);d.id=c.getCountryId(e);c.countries[e]=d;if(this.canvas.mode=="svg"){d.setAttribute("class","jvectormap-region")}else{jQuery(d).addClass("jvectormap-region")}jQuery(this.rootGroup).append(d)}jQuery(a.container).delegate(this.canvas.mode=="svg"?"path":"shape","mouseover mouseout",function(r){var s=r.target,u=r.target.id.split("_").pop(),m=j.Event("labelShow.jqvmap"),t=j.Event("regionMouseOver.jqvmap");if(r.type=="mouseover"){jQuery(a.container).trigger(t,[u,b.pathes[u].name]);if(!t.isDefaultPrevented()){c.highlight(u,s)}if(a.showTooltip){c.label.text(b.pathes[u].name);jQuery(a.container).trigger(m,[c.label,u]);if(!m.isDefaultPrevented()){c.label.show();c.labelWidth=c.label.width();c.labelHeight=c.label.height()}}}else{c.unhighlight(u,s);c.label.hide();jQuery(a.container).trigger("regionMouseOut.jqvmap",[u,b.pathes[u].name])}});jQuery(a.container).delegate(this.canvas.mode=="svg"?"path":"shape","click",function(q){if(!a.multiSelectRegion){for(var m in b.pathes){c.countries[m].currentFillColor=c.countries[m].getOriginalFill();c.countries[m].setFill(c.countries[m].getOriginalFill())}}var r=q.target;var s=q.target.id.split("_").pop();jQuery(a.container).trigger("regionClick.jqvmap",[s,b.pathes[s].name]);if(c.selectedRegions.indexOf(s)!==-1){c.deselect(s,r)}else{c.select(s,r)}});if(a.showTooltip){a.container.mousemove(function(m){if(c.label.is(":visible")){c.label.css({left:m.pageX-15-c.labelWidth,top:m.pageY-15-c.labelHeight})}})}this.setColors(a.colors);this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new h(a.scaleColors,a.normalizeFunction,a.valueMin,a.valueMax);if(a.values){this.values=a.values;this.setValues(a.values)}if(a.selectedRegions){if(a.selectedRegions instanceof Array){for(var f in a.selectedRegions){this.select(a.selectedRegions[f].toLowerCase())}}else{this.select(a.selectedRegions.toLowerCase())}}this.bindZoomButtons();l.mapIndex++};l.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(b,c){if(typeof b=="string"){this.countries[b].setFill(c);this.countries[b].setAttribute("original",c)}else{var d=b;for(var a in d){if(this.countries[a]){this.countries[a].setFill(d[a]);this.countries[a].setAttribute("original",d[a])}}}},setValues:function(d){var f=0,c=Number.MAX_VALUE,b;for(var a in d){b=parseFloat(d[a]);if(b>f){f=d[a]}if(b&&b<c){c=b}}this.colorScale.setMin(c);this.colorScale.setMax(f);var e={};for(a in d){b=parseFloat(d[a]);if(b){e[a]=this.colorScale.getColor(b)}else{e[a]=this.color}}this.setColors(e);this.values=d},setBackgroundColor:function(a){this.container.css("background-color",a)},setScaleColors:function(a){this.colorScale.setColors(a);if(this.values){this.setValues(this.values)}},setNormalizeFunction:function(a){this.colorScale.setNormalizeFunction(a);if(this.values){this.setValues(this.values)}},highlight:function(a,b){b=b||j("#"+this.getCountryId(a))[0];if(this.hoverOpacity){b.setOpacity(this.hoverOpacity)}else{if(this.hoverColor){b.currentFillColor=b.getFill()+"";b.setFill(this.hoverColor)}}},unhighlight:function(a,b){b=b||j("#"+this.getCountryId(a))[0];b.setOpacity(1);if(b.currentFillColor){b.setFill(b.currentFillColor)}},select:function(a,b){b=b||j("#"+this.getCountryId(a))[0];if(this.selectedRegions.indexOf(a)<0){if(this.multiSelectRegion){this.selectedRegions.push(a)}else{this.selectedRegions=[a]}j(this.container).trigger("regionSelect.jqvmap",[a]);if(this.selectedColor){b.currentFillColor=this.selectedColor;b.setFill(this.selectedColor)}}},deselect:function(a,b){b=b||j("#"+this.getCountryId(a))[0];if(this.selectedRegions.indexOf(a)>=0){this.selectedRegions.splice(this.selectedRegions.indexOf(a),1);j(this.container).trigger("regionDeselect.jqvmap",[a]);b.currentFillColor=b.getOriginalFill();b.setFill(b.getOriginalFill())}},isSelected:function(a){return this.selectedRegions.indexOf(a)>=0},resize:function(){var a=this.baseScale;if(this.width/this.height>this.defaultWidth/this.defaultHeight){this.baseScale=this.height/this.defaultHeight;this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)}else{this.baseScale=this.width/this.defaultWidth;this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)}this.scale*=this.baseScale/a;this.transX*=this.baseScale/a;this.transY*=this.baseScale/a},reset:function(){this.countryTitle.reset();for(var a in this.countries){this.countries[a].setFill(l.defaultColor)}this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var b,c,d,a;if(this.defaultWidth*this.scale<=this.width){b=(this.width-this.defaultWidth*this.scale)/(2*this.scale);d=(this.width-this.defaultWidth*this.scale)/(2*this.scale)}else{b=0;d=(this.width-this.defaultWidth*this.scale)/this.scale}if(this.defaultHeight*this.scale<=this.height){c=(this.height-this.defaultHeight*this.scale)/(2*this.scale);a=(this.height-this.defaultHeight*this.scale)/(2*this.scale)}else{c=0;a=(this.height-this.defaultHeight*this.scale)/this.scale}if(this.transY>c){this.transY=c}else{if(this.transY<a){this.transY=a}}if(this.transX>b){this.transX=b}else{if(this.transX<d){this.transX=d}}this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var c=false;var b,d;var a=this;a.isMoving=false;a.isMovingTimeout=false;this.container.mousemove(function(e){if(c){var f=a.transX;var n=a.transY;a.transX-=(b-e.pageX)/a.scale;a.transY-=(d-e.pageY)/a.scale;a.applyTransform();b=e.pageX;d=e.pageY;a.isMoving=true;if(a.isMovingTimeout){clearTimeout(a.isMovingTimeout)}}return false}).mousedown(function(e){c=true;b=e.pageX;d=e.pageY;return false}).mouseup(function(){c=false;a.isMovingTimeout=setTimeout(function(){a.isMoving=false},100);return false})},bindZoomButtons:function(){var a=this;var b=(jQuery("#zoom").innerHeight()-6*2-15*2-3*2-7-6)/(this.zoomMaxStep-this.zoomCurStep);this.container.find(".jqvmap-zoomin").click(function(){if(a.zoomCurStep<a.zoomMaxStep){var d=a.transX;var e=a.transY;var c=a.scale;a.transX-=(a.width/a.scale-a.width/(a.scale*a.zoomStep))/2;a.transY-=(a.height/a.scale-a.height/(a.scale*a.zoomStep))/2;a.setScale(a.scale*a.zoomStep);a.zoomCurStep++;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)-b)}});this.container.find(".jqvmap-zoomout").click(function(){if(a.zoomCurStep>1){var d=a.transX;var e=a.transY;var c=a.scale;a.transX+=(a.width/(a.scale/a.zoomStep)-a.width/a.scale)/2;a.transY+=(a.height/(a.scale/a.zoomStep)-a.height/a.scale)/2;a.setScale(a.scale/a.zoomStep);a.zoomCurStep--;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)+b)}})},setScale:function(a){this.scale=a;this.applyTransform()},getCountryId:function(a){return"jqvmap"+this.index+"_"+a}};l.xlink="http://www.w3.org/1999/xlink";l.mapIndex=1;l.maps={};var h=function(d,c,b,a){if(d){this.setColors(d)}if(c){this.setNormalizeFunction(c)}if(b){this.setMin(b)}if(b){this.setMax(a)}};h.prototype={colors:[],setMin:function(a){this.clearMinValue=a;if(typeof this.normalize==="function"){this.minValue=this.normalize(a)}else{this.minValue=a}},setMax:function(a){this.clearMaxValue=a;if(typeof this.normalize==="function"){this.maxValue=this.normalize(a)}else{this.maxValue=a}},setColors:function(b){for(var a=0;a<b.length;a++){b[a]=h.rgbToArray(b[a])}this.colors=b},setNormalizeFunction:function(a){if(a==="polynomial"){this.normalize=function(b){return Math.pow(b,0.2)}}else{if(a==="linear"){delete this.normalize}else{this.normalize=a}}this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(b){if(typeof this.normalize==="function"){b=this.normalize(b)}var f=[];var a=0;var e;for(var c=0;c<this.colors.length-1;c++){e=this.vectorLength(this.vectorSubtract(this.colors[c+1],this.colors[c]));f.push(e);a+=e}var p=(this.maxValue-this.minValue)/a;for(c=0;c<f.length;c++){f[c]*=p}c=0;b-=this.minValue;while(b-f[c]>=0){b-=f[c];c++}var d;if(c==this.colors.length-1){d=this.vectorToNum(this.colors[c]).toString(16)}else{d=(this.vectorToNum(this.vectorAdd(this.colors[c],this.vectorMult(this.vectorSubtract(this.colors[c+1],this.colors[c]),(b)/(f[c]))))).toString(16)}while(d.length<6){d="0"+d}return"#"+d},vectorToNum:function(c){var b=0;for(var a=0;a<c.length;a++){b+=Math.round(c[a])*Math.pow(256,c.length-a-1)}return b},vectorSubtract:function(a,b){var d=[];for(var c=0;c<a.length;c++){d[c]=a[c]-b[c]}return d},vectorAdd:function(a,b){var d=[];for(var c=0;c<a.length;c++){d[c]=a[c]+b[c]}return d},vectorMult:function(c,b){var d=[];for(var a=0;a<c.length;a++){d[a]=c[a]*b}return d},vectorLength:function(b){var c=0;for(var a=0;a<b.length;a++){c+=b[a]*b[a]}return Math.sqrt(c)}};h.arrayToRgb=function(d){var c="#";var a;for(var b=0;b<d.length;b++){a=d[b].toString(16);c+=a.length==1?"0"+a:a}return c};h.rgbToArray=function(a){a=a.substr(1);return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]}})(jQuery);